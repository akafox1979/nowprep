var nfCookieMonster={set:function(e,t,n,i,o){var s=new Date,r="",a=typeof t,l="",d="";if(i=i||"/",n&&(s.setTime(s.getTime()+24*n*60*60*1e3),r="; expires="+s.toUTCString()),"object"===a&&"undefined"!==a){if(!("JSON"in window))throw"Bummer, your browser doesn't support JSON parsing.";l=encodeURIComponent(JSON.stringify({v:t}))}else l=encodeURIComponent(t);o&&(d="; secure"),document.cookie=e+"="+l+r+"; path="+i+d},get:function(e){for(var t=e+"=",n=document.cookie.split(";"),i="",o="",s={},r=0;r<n.length;r++){for(var a=n[r];" "==a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t)){if(i=decodeURIComponent(a.substring(t.length,a.length)),o=i.substring(0,1),"{"==o)try{if(s=JSON.parse(i),"v"in s)return s.v}catch(l){return i}if("undefined"==i)return;return i}}return null},remove:function(e){this.set(e,"",-1)},increment:function(e,t){var n=this.get(e)||0;this.set(e,parseInt(n,10)+1,t)},decrement:function(e,t){var n=this.get(e)||0;this.set(e,parseInt(n,10)-1,t)}},nfSaveProgressActiveController=Marionette.Object.extend({endpoint:nfSaveProgress.restApiEndpoint||"",initialize:function(e){this.listenTo(Backbone.Radio.channel("form"),"render:view",this.onFormRenderView)},onFormRenderView:function(e){if(nfSaveProgress.currentUserID){var t=e.model,n=t.get("fields").findWhere({type:"save"});return"undefined"==typeof n?void jQuery("#formSave"+t.get("id")).remove():t.get("save_progress_allow_multiple")?this.renderSaveTable(t):this.loadLastSave(t)}},loadLastSave:function(e){var t=new SavesLoadingView;t.render(),jQuery.ajax({url:this.endpoint+"saves/"+e.get("id"),type:"GET",data:{_wpnonce:wpApiSettings.nonce},cache:!1,success:function(n,i,o){if(jQuery(t.$el).slideUp(400,function(){t.remove()}),0==n.saves.length)return void jQuery("#formSave"+e.get("id")).remove();var s=n.saves.pop();e.set("save_id",s.save_id);var r=JSON.parse(s.fields);Backbone.Radio.channel("forms").request("save:updateFieldsCollection",e.get("id"),r),jQuery("#formSave"+e.get("id")).remove()},error:function(){}})},renderSaveTable:function(e){var t=new SavesLoadingView;t.render();var n=new SavesCollection([],{formModel:e});n.fetch({success:function(){t.remove();new SavesCollectionView({collection:n})}})}}),nfSaveProgressPassiveController=Marionette.Object.extend({cookie:{},initialize:function(e){this.cookie=e.cookie,this.listenTo(nfRadio.channel("form"),"render:view",this.onFormRendered)},onFormRendered:function(e){var t=e.model;if(t.get("save_progress_passive_mode")){var n=this.cookie.get("nfForm-"+t.get("id"))||{};Backbone.Radio.channel("forms").request("save:updateFieldsCollection",t.get("id"),n),this.listenTo(nfRadio.channel("fields"),"change:modelValue",this.onChangeModelValue),this.listenTo(nfRadio.channel("form-"+t.get("id")),"submit:response",function(){this.cookie.remove("nfForm-"+t.get("id"))})}},onChangeModelValue:function(e){var t="nfForm-"+e.get("formID"),n=e.get("formID"),i=Backbone.Radio.channel("app").request("get:form",n);if("undefined"!=typeof i&&i.get("save_progress_passive_mode")){var o=Backbone.Radio.channel("forms").request("save:fieldAttributes",n);this.cookie.set(t,o)}}}),nfSaveProgressSaveButtonController=Marionette.Object.extend({endpoint:"",initialize:function(e){this.endpoint=nfSaveProgress.restApiEndpoint||"",Backbone.Radio.channel("forms").reply("maybe:validate",this.maybeValidate),this.listenTo(nfRadio.channel("save"),"init:model",this.registerHandlers),this.listenTo(nfRadio.channel("save"),"render:view",this.maybeHide),this.listenTo(nfRadio.channel("save"),"click:field",this.click)},maybeValidate:function(e){if(e.getExtra("saveProgress"))return!1},registerHandlers:function(e){var t=Backbone.Radio.channel("form-"+e.get("formID"));e.listenTo(t,"before:submit",this.beforeSubmit,e),e.listenTo(t,"submit:cancel",this.reset.bind(e)),e.listenTo(t,"submit:response",this.reset.bind(e)),e.listenTo(t,"submit:response",this.response.bind(this));var n=e.get("formID");e.listenTo(t,"submit:failed",function(){Backbone.Radio.channel("form-"+n).request("remove:extra","saveProgress")}),e.listenTo(t,"submit:response",function(){Backbone.Radio.channel("form-"+n).request("remove:extra","saveProgress")}),Backbone.Radio.channel("save").reply("get:submitData",function(t){n=e.get("formID");var i=Backbone.Radio.channel("app").request("get:form",n);return"undefined"!=typeof i&&(t.save_id=i.get("save_id")),t.fields=Backbone.Radio.channel("forms").request("save:fieldAttributes",n),t}),this.listenTo(nfRadio.channel("submit"),"init:model",this.registerSubmitHandlers)},registerSubmitHandlers:function(e){e.listenTo(nfRadio.channel("form-"+e.get("formID")),"before:submit",function(e){Backbone.Radio.channel("form-"+e.get("id")).request("get:extra","saveProgress")&&("undefined"!=typeof this.get("oldLabel")&&this.set("label",this.get("oldLabel")),this.set("disabled",!0),this.trigger("reRender"))},e)},beforeSubmit:function(){this.set("disabled",!0),this.trigger("reRender")},maybeHide:function(e){nfSaveProgress.currentUserID||setTimeout(function(){e.remove()},500)},click:function(e,t){t.set("disabled",!0),t.set("oldLabel",t.get("label")),t.set("label",t.get("processing_label")),console.log(t),t.trigger("reRender");var n=t.get("formID"),i=Backbone.Radio.channel("app").request("get:form",n);Backbone.Radio.channel("form-"+n).request("add:extra","saveProgress",1),Backbone.Radio.channel("form-"+n).request("submit",i)},response:function(e,t,n,i){1==e.data.settings.hide_complete&&jQuery("#formSave"+e.data.form_id).hide()},reset:function(){console.log(this),this.set("disabled",!1),"undefined"!=typeof this.get("oldLabel")&&this.set("label",this.get("oldLabel")),this.trigger("reRender")}}),SaveModel=Backbone.Model.extend({parse:function(e,t){return e.fields=JSON.parse(e.fields),e}}),SavesCollection=Backbone.Collection.extend({model:SaveModel,url:function(){var e=this.formModel.get("id");return nfSaveProgress.restApiEndpoint+"saves/"+e},initialize:function(e,t){this.formModel=t.formModel},parse:function(e){if("undefined"!=typeof e.saves)return e.saves},setAuthHeaders:function(e){"undefined"!=typeof wpApiSettings.nonce&&e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},sync:function(e,t,n){return n=n||{},n.beforeSend=this.setAuthHeaders,Backbone.sync(e,t,n)}}),SaveItemView=Marionette.ItemView.extend({tagName:"tr",className:"nf-saves-item",template:"#tmpl-nf-save-item",events:{"click .load":function(e){jQuery(e.target).closest(".nf-saves-cont").find(".active").removeClass("active"),jQuery(e.target).closest("tr").addClass("active");var t=this.model.get("form_id");Backbone.Radio.channel("forms").request("save:updateFieldsCollection",t,this.model.get("fields"));var n=Backbone.Radio.channel("app").request("get:form",t);"undefined"!=typeof n&&n.set("save_id",this.model.get("save_id"))},"click .cancel":function(e){jQuery(e.target).closest("tr").removeClass("active");var t=this.model.get("form_id"),n=Backbone.Radio.channel("app").request("get:form",t),i=n.get("fields"),o=n.get("loadedFields");i.reset(o)}},templateHelpers:function(){var e=this;return{updated:moment(this.updated).format("MM/DD/YY, h:mm A"),columns:function(){console.log(e.model);var t=nfRadio.channel("app").request("get:form",e.model.get("form_id")),n=t.get("save_progress_table_columns"),i="";return _.each(n,function(n){var o=t.get("fields").find(function(e){return n.field==e.get("key")}),s=e.model.get("fields").find(function(e){return o.get("id")==e.id}),r="undefined"!=typeof s?s.value:"";i+="<td>"+r+"</td>"}),i}}}}),SaveEmptyView=Marionette.ItemView.extend({tagName:"nf-save",template:"#tmpl-nf-save-empty",initialize:function(){this.on("render",this.afterRender)},afterRender:function(){var e=this;setTimeout(function(){jQuery(e.$el).slideUp("slow",function(){e.remove()})},2e3)}}),SavesLoadingView=Marionette.ItemView.extend({tagName:"nf-section",template:"#tmpl-nf-saves-loading",el:".form-save-loading"}),SavesCollectionView=Marionette.CompositeView.extend({tagName:"table",childView:SaveItemView,emptyView:SaveEmptyView,childViewContainer:"tbody",template:"#tmpl-nf-save-table",initialize:function(e){var t=this.collection.formModel.get("id");this.el="#formSave"+t+" table",this.$el=jQuery(this.el),this.render(),this.listenTo(Backbone.Radio.channel("form-"+t),"submit:response",function(){var e=this;this.collection.fetch({success:function(){e.render()}})},this)},onRender:function(){0==this.collection.length?(this.$el.hide(),this.$el.parent().hide()):(this.$el.show(),this.$el.parent().show())},templateHelpers:function(){var e=this;return{headers:function(){var t=e.collection.formModel,n=t.get("save_progress_table_columns"),i="";return _.each(n,function(e){var n=t.get("fields").find(function(t){return e.field==t.get("key")});i+="<th>"+n.get("label")+"</th>"}),i}}}}),NF_SaveProgress=Marionette.Application.extend({initialize:function(e){new nfSaveProgressActiveController,new nfSaveProgressSaveButtonController,new nfSaveProgressPassiveController({cookie:nfCookieMonster}),Backbone.Radio.channel("forms").reply("save:fieldAttributes",this.getfieldAttributes,this),Backbone.Radio.channel("forms").reply("save:updateFieldsCollection",this.updateFieldsCollection,this)},getfieldAttributes:function(e){var t=Backbone.Radio.channel("app").request("get:form",e),n=t.get("fields").map(function(e,t){return _.omit(e.attributes,["disabled","afterField","beforeField","classes","confirm_field","element_templates","errors","formID","key","label","label_pos","mirror_field","objectDomain","objectType","old_classname","order","parentType","placeholder","reRender","type","wrap_template"])});return n},updateFieldsCollection:function(e,t){var n=Backbone.Radio.channel("app").request("get:form",e),i=n.get("fields"),o=n.get("loadedFields");i.reset(o),_.each(t,function(e){var t=parseInt(e.id),n=i.get(t),o=_.omit(e,["id"]);"undefined"!=typeof o.visible&&(o.visible=o.visible.toString()),"undefined"!=typeof n&&n.set(o)})}});jQuery(document).ready(function(e){var t=new NF_SaveProgress;t.start()});
//# sourceMappingURL=front-end.min.js.map
