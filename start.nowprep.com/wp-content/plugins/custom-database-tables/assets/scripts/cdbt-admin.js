/*!
 * Custom DataBase Tables v2.1.31 (http://ka2.org)
 * Copyright 2014-2016 ka2@ka2.org
 * Licensed under GPLv2 (http://www.gnu.org/licenses/gpl.txt)
 */
var docCookies={getItem:function(e){return e&&this.hasItem(e)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},setItem:function(e,t,a,i,n,r){if(e&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(e)){var o="";if(a)switch(a.constructor){case Number:o=a===1/0?"; expires=Tue, 19 Jan 2038 03:14:07 GMT":"; max-age="+a;break;case String:o="; expires="+a;break;case Date:o="; expires="+a.toGMTString()}document.cookie=escape(e)+"="+escape(t)+o+(n?"; domain="+n:"")+(i?"; path="+i:"")+(r?"; secure":"")}},removeItem:function(e,t){e&&this.hasItem(e)&&(document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; path="+t:""))},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=unescape(e[t]);return e}};$(document).ready(function(){$.QueryString=function(e){if(""===e)return{};for(var t={},a=0;a<e.length;++a){var i=e[a].split("=");2===i.length&&(t[i[0]]=decodeURIComponent(i[1].replace(/\+/g," ")))}return t}(window.location.search.substr(1).split("&")),$.em2pxl=function(e){""===e&&(e=1);var t=$('<div style="width:'+e+'em;"></div>').appendTo("body"),a=t.width();return t.remove(),a},$.strWidth=function(e){if(""===arguments[0])return 0;var t,a=$('<span style="visibility:hidden;position:absolute;white-space:nowrap;"></span>').appendTo("body");return void 0!==arguments[1]&&arguments[1]&&(e=$("<div/>").html(e).text()),t=a.text(e).get(0).offsetWidth,a.remove(),t},$.imageSize=function(e){var t={w:0,h:0},a=new Image;return a.src=e,t.w=a.width,t.h=a.height,t},$.htmlEntities=function(e,t){if("encode"===t){for(var a=[],i=e.length-1;i>=0;i--)a.unshift(["&#",e[i].charCodeAt(),";"].join(""));return a.join("")}return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)})},$.isDebug="true"===cdbt_admin_vars.is_debug?!0:!1,$.ajaxUrl=cdbt_admin_vars.ajax_url,$.ajaxNonce=cdbt_admin_vars.ajax_nonce,$.modalNotices="true"===cdbt_admin_vars.notices_via_modal?!0:!1,$.localErrMsg=decodeURIComponent(cdbt_admin_vars.local_err_msg.replace(/\+/g," ")),$.localCopied=decodeURIComponent(cdbt_admin_vars.local_copied.replace(/\+/g," ")),$.onTimer=!1,$.isDebug&&console.info($.extend({debugMode:"ON",modalNotices:$.modalNotices},$.QueryString)),$.ajaxResponse={};var t=function(){this.reload_timer=function(){if($.onTimer){var e=new Date;$(".cdbt-datepicker").datepicker("getDate",e),$('.datepicker-combobox-hour[data-on-timer="true"] input[type="text"]').val(("00"+e.getHours()).slice(-2)),$('.datepicker-combobox-minute[data-on-timer="true"] input[type="text"]').val(("00"+e.getMinutes()).slice(-2)),$('.datepicker-combobox-second[data-on-timer="true"] input[type="text"]').val(("00"+e.getSeconds()).slice(-2))}},this.render_modal=function(){$("div.cdbt-modal").size()>0&&($("div.cdbt-modal").remove(),$("#append-dynamic-modal").remove()),$("body").append($.ajaxResponse.responseText),/^\[\{.*\}\]$/im.test($(".cdbt-modal .modal-body").text().trim())&&$(".cdbt-modal .modal-body").html('<textarea class="inner-preview cdbt-clipboard">'+$(".cdbt-modal .modal-body").text().trim()+"</textarea>").queue(function(){var e=$(window).height()-$(".modal-header").height()-$(".modal-footer").height()-($("#wpadminbar").size()>0?$("#wpadminbar").height():0);$(".inner-preview").css({height:Math.ceil(.6*e)+"px"})})},this.load_into_modal=function(){if($("div.cdbt-modal").size()>0){$("div.modal-body").html($.ajaxResponse.responseText).trigger("create"),$.ajaxResponse.responseText="";var e=$("form#"+$("div.modal-body").find("form").attr("id"));e.find(".checkbox-custom").checkbox("enable"),e.find(".combobox").combobox("enable"),e.find(".infinitescroll").infinitescroll("enable"),e.find(".loader").loader("reset"),e.find(".pillbox").pillbox(),e.find(".placard").placard("enable"),e.find(".radio").radio("enable"),e.find(".search").search("enable"),e.find(".selectlist").selectlist("enable"),e.find(".spinbox").spinbox(),e.find(".tree").tree("render"),e.find(".wizard").wizard(),e.find(".repeater").repeater("render"),e.find(".datepicker").each(function(){var e=$(this).attr("id").replace("entry-data-","").split("-"),t=e[0],a=$('input[name="custom-database-tables['+t+'][prev_date]"]').val();$(this).datepicker({date:new Date(a),allowPastDates:!0,restrictDateSelection:!0,momentConfig:{culture:$(this).data("momentLocale"),format:$(this).data("momentFormat")}}),$.onTimer=!1}),$("div.modal-body").find("input,textarea,select").each(function(){"undefined"!=typeof $(this).attr("required")&&$(this).prop("required",!0)})}},this.set_importing_sql=function(){$('textarea[name="confirm_sql"]').val($.ajaxResponse.responseText)},this.set_api_key=function(){$("#current_host_apikey").val($.ajaxResponse.responseText)},this.show_columns_info=function(){$("#columns-information").html("").append($.ajaxResponse.responseText)},this.hide_columns_info=function(){$("#columns-information").html("").append($.ajaxResponse.responseText).queue(function(){$("#columns-detail").addClass("hide"),$("#collapse-reference").children("i").attr("class","fa fa-plus-square")})}},a=new t,i=function(){var e={};arguments.length>0&&(e=arguments[0]),$("div.cdbt-modal").size()>0&&($("div.cdbt-modal").remove(),$("#append-dynamic-modal").remove()),l($.ajaxUrl,"post",_.extend(e,{event:"retrieve_modal"}),"html","render_modal")};if("undefined"!=typeof wizard&&$("#cdbt-wizard").on("finished.fu.wizard",function(e){if("introduction"===e.target.previousElementSibling.className){u={id:"cdbtModal",insertContent:!0,modalTitle:"hide_tutorial",modaleBody:"",modalExtras:{hide_tutorial:!0}},i(u);var t=$(e.target.previousElementSibling),a=$(this);$(document).on("click","#hide_tutorial",function(e){t.addClass("hide"),a.addClass("hide");var i={event:"update_options",hide_tutorial:!0};l($.ajaxUrl,"post",i,"script")})}}),"undefined"!=typeof DynamicTables&&(_.each($(".cdbt-table-wrapper").find("table").map(function(){return this.id}).get(),function(e){var t=new DynamicTables[e];return t.render()}),$(document).on("click",".cdbt-table-wrapper .modal-preview",function(){var e=$(this).children("img").attr("src"),t="",a={id:"cdbtModal",insertContent:!0,modalTitle:"",modalBody:""};if("undefined"!=typeof e){t=e;var n=$(window).height()-200-($("#wpadminbar").size()?$("#wpadminbar").outerHeight():0);a.modalTitle="image_preview",a.modalSize="large",a.modalBody='<div class="preview-image-body"><img src="'+t+'" class="center-block" style="max-height:'+n+'px; width: inherit;"></div>'}else t=$(this).text(),a.modalTitle="binary_downloader",a.modalExtras={table_name:$(this).data().targetTable,target_column:$(this).data().columnName,where_clause:$(this).data().whereConditions};i(a)})),"undefined"!=typeof repeater){_.each(repeater,function(e,t){return repeater[t]()});var n=function(){$(".repeater table tr").each(function(){$(this).children("th").removeAttr("style"),$(this).children("td").removeAttr("style"),$(this).find(".repeater-list-heading").removeAttr("style"),$(".repeater-list-heading").each(function(){$(this).css("width",$(this).parent("th").width()+16+"px")})})},r=function(e){docCookies.setItem("cdbtOperatingTable",e.targetTable);var t={session_key:e.sessionKey,default_action:e.operateAction,target_table:e.targetTable,callback_url:e.baseUrl};return l($.ajaxUrl,"post",t,"script")};if(_.contains(["cdbtAdminTables","cdbtWpCoreTables"],$(".repeater").attr("id"))&&($(document).on("click",".cdbt-repeater-left-main>a",function(){r(_.extend($(this).data(),{sessionKey:"operate_table"}))}),$(document).on("click",".operate-table-btn-group>button",function(){r(_.extend($(this).data(),{sessionKey:"operate_table"}))}),$(document).on("click",".operate-data-btn-group>button",function(){r(_.extend($(this).data(),{sessionKey:"operate_data"}))}),$(document).on("rendered.fu.repeater",".repeater",function(e){$(this).find(".sorted").removeClass("sorted");var t,a,i=$(this).data("cols").split(","),n=docCookies.getItem("cdbtSortCache"),r=JSON.parse(n);"object"==typeof r&&_.size(r)>0&&"undefined"!=typeof r[$(this).attr("id")]?(t=i[r[$(this).attr("id")][0]],a=r[$(this).attr("id")][1]):(t=$(this).data().currentSortCol,a=$(this).data().currentSortDirection),_.contains(i,t)&&$(this).find("thead th.sortable").each(function(){var e=_.indexOf(i,t);if($(this).index()===e){$(this).addClass("sorted").find(".sortable").addClass("sorted");var n="asc"===a?"up":"down";$(this).find(".rlc").attr("class","glyphicon rlc glyphicon-chevron-"+n)}else $(this).find(".rlc").attr("class","glyphicon rlc")})}),$(document).on("click","th.sortable",function(){var t=$(this).parents(".repeater"),a=docCookies.getItem("cdbtSortCache");if(void 0===t.data("cols"))return!1;var i,r,o,s=t.data("cols").split(","),c=$(this).index();if(null!==a){var d=JSON.parse(a);"object"==typeof d&&_.size(d)>0&&"undefined"!=typeof d[t.attr("id")]?(i=d[t.attr("id")][0],r=d[t.attr("id")][1],i!==c?i=c:t.data().currentSortDirection=r,t.data().currentSortCol=s[i]):(i=c,t.data().currentSortCol=s[i],r=t.data().currentSortDirection),o="desc"===r?"asc":"desc"}else i=c,t.data().currentSortCol=s[i],r=t.data().currentSortDirection,o="desc"===r?"asc":"desc";a={},a[t.attr("id")]=new Array(i,o,String(e.timeStamp)),docCookies.getItem("cdbtSortCache",JSON.stringify(a)),t.repeater("render"),n()}),n()),_.contains(["cdbtShortcodes"],$(".repeater").attr("id"))){$(document).on("click",".cdbt-repeater-left-main>a, .scl-operation-buttons button",function(){var e=$(this).data(),t={default_action:e.operateAction,target_shortcode:e.targetSc,target_scid:e.targetScid,callback_url:e.baseUrl};return"register"===e.operateAction||"edit"===e.operateAction?(t=_.extend(t,{session_key:"shortcode_"+e.operateAction}),l($.ajaxUrl,"post",t,"script")):void("delete"===e.operateAction&&(t={id:"cdbtModal",insertContent:!0,modalTitle:"delete_shortcode",modaleBody:"",modaleHideEvent:"$('input[name=\"custom-database-tables[operate_action]\"]').val('detail'); $('form.navbar-form').trigger('submit');",modalExtras:{target_scid:e.targetScid}},i(t)))});var o=function(){$(".cdbt-repeater-row").each(function(){var e=$(this).children(".col-scl-name").children(".cdbt-repeater-left-main").children("a"),t=$(this).children(".col-scl-type").text(),a=$(this).children(".col-scl-operation").children(".scl-operation-buttons");"built-in"===t?(e.attr("data-operate-action","register"),a.children(".operate-shortcode-edit-btn-group").remove()):"deprecated"===t?(e.replaceWith(e.text()),a.remove()):(e.replaceWith("<code>"+e.text()+"</code>"),a.children(".operate-shortcode-register-btn-group").remove())}),n()};$(document).on("click submit keydown","#cdbtShortcodes",function(){o()}),o();0===$(".repeater").attr("id").indexOf("cdbt-repeater-edit-");$(document).on("rendered.fu.repeater","#cdbtShortcodes",function(e){$(this).find(".sorted").removeClass("sorted");var t,a,i=$(this).data("cols").split(","),n=docCookies.getItem("cdbtSortCache"),r=JSON.parse(n);"object"==typeof r&&_.size(r)>0&&"undefined"!=typeof r[$(this).attr("id")]?(t=i[r[$(this).attr("id")][0]],a=r[$(this).attr("id")][1]):(t=$(this).data().currentSortCol,a=$(this).data().currentSortDirection),_.contains(i,t)&&$(this).find("thead th.sortable").each(function(){var e=_.indexOf(i,t);if($(this).index()===e){$(this).addClass("sorted").find(".sortable").addClass("sorted");var n="asc"===a?"up":"down";$(this).find(".rlc").attr("class","glyphicon rlc glyphicon-chevron-"+n)}else $(this).find(".rlc").attr("class","glyphicon rlc")})}),$(document).on("click","th.sortable",function(e){var t=$(this).parents(".repeater"),a=docCookies.getItem("cdbtSortCache");if(void 0===t.data("cols"))return!1;var i,r,o,s=t.data("cols").split(","),c=$(this).index();if(null!==a){var d=JSON.parse(a);"object"==typeof d&&_.size(d)>0&&"undefined"!=typeof d[t.attr("id")]?(i=d[t.attr("id")][0],r=d[t.attr("id")][1],i!==c?i=c:t.data().currentSortDirection=r,t.data().currentSortCol=s[i]):(i=c,t.data().currentSortCol=s[i],r=t.data().currentSortDirection),o="desc"===r?"asc":"desc"}else i=c,t.data().currentSortCol=s[i],r=t.data().currentSortDirection,o="desc"===r?"asc":"desc";a={},a[t.attr("id")]=new Array(i,o,String(e.timeStamp)),docCookies.getItem("cdbtSortCache",JSON.stringify(a)),t.repeater("render"),n()})}if(_.contains(["cdbtAllowedHosts"],$(".repeater").attr("id"))){$(document).on("click",".operate-webapi-deletion-btn-group button",function(){var e=$(this).data();if("delete"===e.operateAction){var t={id:"cdbtModal",insertContent:!0,modalTitle:"delete_host",modaleBody:"",modaleHideEvent:"$('input[name=\"custom-database-tables[operate_action]\"]').val('detail'); $('form.navbar-form').trigger('submit');",modalExtras:{host_name:e.targetHost,host_id:e.targetHostid}};i(t)}});var s=function(){$("td.col-ahl-permission").each(function(){var e=$(this).text().split(","),t=_.reduce(e,function(e,t){return e+'<span class="label label-primary" style="display: inline-block; margin-right: 4px;">'+t+"</span>"},"");$(this).html(t)}),n()};$(document).on("click submit keydown","#cdbtShortcodes",function(){s()}),s(),$(document).on("click","th.sortable",function(){s(),n()})}-1!==$(".repeater").attr("id").indexOf("cdbt-repeater-view-")&&$(document).on("click","th.sortable",function(){})}if($(".cdbt-datepicker").size()>0){var c=$("form#"+$(".cdbt-datepicker").parents("form").attr("id"));c.find(".cdbt-datepicker").each(function(){$(this).data().momentLocale&&$(this).data().momentFormat&&$(this).datepicker({momentConfig:{culture:$(this).data().momentLocale,format:$(this).data().momentFormat}}),"undefined"==typeof $(this).data("date")?$(this).datepicker("getDate",new Date):$(this).datepicker("setDate",$(this).data("date"));var e=$(this).parent().next("input[type=hidden]").val();"0000-00-00 00:00:00"===e?($.onTimer=!0,a.reload_timer()):$.onTimer=!1})}if(void 0!==$.fn.kinetic&&$(".cdbt-kinetic").kinetic({filterTarget:function(e,t){return/down|start/.test(t.type)?void 0:!/span|area|a|input/i.test(e.tagName)}}),"function"==typeof Clipboard){var d=new Clipboard(".cdbt-clipboard",{text:function(e){var t,a=$(e);return t="TEXTAREA"===a.context.tagName||"INPUT"===a.context.tagName?a.val():a.text()||!1,t&&""!==t?(a.addClass("cdbt-copied"),t):!1}});d.on("success",function(e){var t=$(e.trigger);t.tooltip({trigger:"manual",title:$.localCopied}).tooltip("show"),t.animate({backgroundColor:"#fff",color:"#333"},500,function(){t.removeClass("cdbt-copied").tooltip("hide"),e.clearSelection()})}),d.on("error",function(e){var t=$(e.trigger);t.removeClass("cdbt-copied").tooltip("hide"),e.clearSelection()})}var l=function(){if(arguments.length<2)return!1;var e=arguments[0],t=arguments[1],i="undefined"!=typeof arguments[2]?arguments[2]:null,n="undefined"!=typeof arguments[3]?arguments[3]:"text",r="undefined"!=typeof arguments[4]?arguments[4]:null,o=$.ajax({async:!0,url:e,type:t,data:i,dataType:n,cache:!1,beforeSend:function(e,t){}});o.done(function(e,t,i){return $.isDebug&&console.log({done:t,data:e,xhr:i}),"script"===n?e:(/0$/im.test(o.responseText)&&(o.responseText=o.responseText.substr(0,o.responseText.length-1)),$.ajaxResponse={responseText:o.responseText,status:o.status,statusText:o.statusText},""!==r?a[r]():void 0)}),o.fail(function(e,t,a){$.isDebug&&console.log({fail:t,error:a,xhr:e})}),o.always(function(e,t,a){$.isDebug&&console.log({always:t,res1:e,res2:a})})};if(""!==$("#message").text().trim())if($.modalNotices){var u={id:"cdbtModal",insertContent:!0,modalTitle:"notices_"+$("#message").attr("class"),modalBody:$("#message").html()};i(u)}else $("#message").show();if("cdbt_tables"===$.QueryString.page&&"create_table"===$.QueryString.tab){var p=function(e){$("#instance_prefix_switcher .checkbox-custom").checkbox("isChecked")&&(e=$("#create-table-table_name div.input-group-addon").text()+e),$("#live_preview code").text(e),$('input[name="custom-database-tables[table_name]"]').val(e)};$("#instance_table_name").on("change keypress keyup paste",function(){p($(this).val())});var b=function(e){e?$("#create-table-table_name div.input-group-addon").removeClass("sr-only"):$("#create-table-table_name div.input-group-addon").addClass("sr-only"),p($("#instance_table_name").val())};$('.checkbox input[name="instance_prefix_switcher"]').on("change",function(){b($(this).is(":checked"))}),b($("#instance_prefix_switcher .checkbox-custom").checkbox("isChecked")),$("#create-sql-support").on("click",function(){var e=_.template("CREATE TABLE <%= tableName %> ( <%= columnDefinition %> ) <%= tableOptions %>;"),t="",a=[],i="",n=$("#instance_create_table_sql").val(),r=[],o={primary_key:[],index:[],unique:[],fulltext:[],foreign_key:[]},s=JSON.parse(localStorage.getItem("cdbt-tc-cache")),c=[],d=!1;""!==n&&null!==s&&_.isArray(s)&&s.length>0&&_.each(s,function(e){if(""!==e.key_index){var t=e.key_index.toLowerCase().replace(" ","_");o[t].push(e.col_name)}e.auto_increment&&(d=!0),c.push(e.col_name)}),""!==$('input[name="custom-database-tables[table_name]"]').val()&&(t="`"+$('input[name="custom-database-tables[table_name]"]').val()+"`"),""!==$('input[name="custom-database-tables[table_db_engine]"]').val()&&a.push("ENGINE="+$('input[name="custom-database-tables[table_db_engine]"]').val()),""!==$('input[name="custom-database-tables[table_charset]"]').val()&&a.push("DEFAULT CHARSET="+$('input[name="custom-database-tables[table_charset]"]').val()),""!==$('input[name="custom-database-tables[table_comment]"]').val()&&a.push("COMMENT='"+$('input[name="custom-database-tables[table_comment]"]').val()+"'"),$("#automatically-add-columns1 .checkbox-custom").checkbox("isChecked")&&(""!==n&&(_.contains(c,"ID")||o.primary_key.length>0)?$("#automatically-add-columns1 .checkbox-custom").checkbox("uncheck"):(i="`ID` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID', ",o.primary_key.push("ID"),d=!0)),$("#automatically-add-columns2 .checkbox-custom").checkbox("isChecked")&&(""!==n&&_.contains(c,"created")?$("#automatically-add-columns2 .checkbox-custom").checkbox("uncheck"):r.push("`created` datetime NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT 'Created Datetime'")),$("#automatically-add-columns3 .checkbox-custom").checkbox("isChecked")&&(""!==n&&_.contains(c,"updated")?$("#automatically-add-columns3 .checkbox-custom").checkbox("uncheck"):r.push("`updated` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Updated Datetime'"));var l=[];_.each(o,function(e,t){e.length>0&&l.push(t.toUpperCase().replace("_"," ")+"(`"+e.join("`,`")+"`) ")}),i=""!==i?i+"\n":"",n=""!==n?n+"\n":"",r=r.length>0?r.concat(l):l;var u="\n"+i+n;r.length>0?u+=r.join(", \n"):u=u.substring(0,u.lastIndexOf(", \n"))+" \n",d&&a.push("AUTO_INCREMENT=1"),$("#create-table-create_table_sql").val(e({tableName:t,columnDefinition:u,tableOptions:"\n"+a.join(" ")}))}),$("#after-notice-redirection").size()>0&&$(document).on("hidden.bs.modal","#cdbtModal",function(e){var t={session_key:"operate_table",default_action:"detail",target_table:$("input[name=target_table]").val(),callback_url:$("#after-notice-redirection").val()};return l($.ajaxUrl,"post",t,"script")}),$("a[data-toggle=tab]").on("shown.bs.tab",function(e){if("table_creator"===e.target.hash.substr(1)){var t={id:"cdbtTableCreator",insertContent:!0,modalSize:"large",modalTitle:"table_creator",modalBody:"",modalHideEvent:"$('#adminmenuwrap').show();$('a[data-toggle=tab]:first').tab('show');",modalShowEvent:"doTableCreator();",modalExtras:{column_definitions:$("#instance_create_table_sql").val()}};i(t)}})}if("cdbt_tables"===$.QueryString.page&&"modify_table"===$.QueryString.tab){$("#modify-table-action-change_table").on("click",function(e){return e.preventDefault(),""===$("#modify-table-change_table").selectlist("selectedItem").value?!1:(u={session_key:"modify_table",target_table:$("#modify-table-change_table").selectlist("selectedItem").value,callback_url:"./admin.php?page=cdbt_tables&tab=modify_table"},void l($.ajaxUrl,"post",u,"script"))}),$('button[id^="btn-undo-modify-table-"]').on("click",function(){var e=$(this).attr("id").replace("btn-undo-","");$("#"+e).val($(this).data().prevValue),"modify-table-sanitization_input"===e&&($(this).data().prevValue?$("#"+e).parent().checkbox("check"):$("#"+e).parent().checkbox("uncheck"))}),$("input,button,.dropdown-menu>li>a").on("click blur change keypress keyup",function(){$(".form-group").each(function(){var e=$(this).find('input[id^="modify-table-"]').val();if("string"==typeof e&&$(this).find('button[id^="btn-undo-"]').size()>0&&"undefined"!=typeof $(this).find('button[id^="btn-undo-"]').attr("data-prev-value")){var t=$(this).find('button[id^="btn-undo-"]').attr("data-prev-value");e!==t?$(this).addClass("has-success"):$(this).removeClass("has-success")}})}),$('textarea[id^="modify-table-"]').on("blur keypress keyup",function(){$(this).val()!==$("#btn-undo-"+$(this).attr("id")).data().prevValue?$(this).parents(".form-group").addClass("has-success"):$(this).parents(".form-group").removeClass("has-success")}),$("#btn-undo-modify-table-alter_table_sql").on("click",function(){$("#modify-table-alter_table_sql").parents(".form-group").removeClass("has-success")}),$(".checkbox input").on("change",function(){$(this).is(":checked")?$(this).val("1"):$(this).val("0")});var m=function(){var e="",t=0;return e=1!==arguments.length?".form-group":"#"+arguments[0]+" .form-group",$(e).each(function(){$(this).hasClass("has-success")&&t++}),t};$("#submit-alter-table, #submit-update-options").on("click",function(e){e.preventDefault();var t=$(this).parents("form").attr("id");m(t)>0?$("#"+t).trigger("submit"):(u={id:"cdbtModal",insertContent:!0,modalTitle:"changing_item_none",modalBody:""},i(u))}),$("#after-notice-redirection").size()>0&&$(document).on("hidden.bs.modal","#cdbtModal",function(e){return u={session_key:"operate_table",default_action:"detail",target_table:$("input[name=target_table]").val(),callback_url:$("#after-notice-redirection").val()},l($.ajaxUrl,"post",u,"script")})}if("cdbt_tables"===$.QueryString.page&&"operate_table"===$.QueryString.tab){$('button[id^="operate-table-action-"]').on("click",function(e){if(""===$("#operate-table-target_table").selectlist("selectedItem").value)return e.preventDefault(),!1;var t,a=_.last($(this).attr("id").split("-"));"change_table"===a&&(a="detail",t=$("#operate-table-target_table").selectlist("selectedItem").value,docCookies.setItem("cdbtOperatingTable",t)),$('input[name="custom-database-tables[operate_action]"]').val(a),$('button[id^="operate-table-action-"]').removeClass("active"),$(this).addClass("active"),$common_modal_hide="$('input[name=\"custom-database-tables[operate_action]\"]').val('detail'); $('form.navbar-form').trigger('submit');";var n={};if(""===$('input[name="custom-database-tables[operate_current_table]"]').val())n={id:"cdbtModal",insertContent:!0,modalTitle:"table_unknown",modalBody:"",modalHideEvent:$common_modal_hide},i(n);else switch(a){case"detail":case"import":case"export":case"duplicate":case"backup":$("section").each(function(){a===$(this).attr("id")?$(this).attr("class","show"):$(this).attr("class","hidden")});break;case"truncate":n={id:"cdbtModal",insertContent:!0,modalTitle:"truncate_table",modalBody:"",modalHideEvent:$common_modal_hide,modalExtras:{table_name:$('input[name="custom-database-tables[operate_current_table]"]').val()}},i(n);break;case"modify":n={session_key:"modify_table",target_table:$('input[name="custom-database-tables[operate_current_table]"]').val(),callback_url:"./admin.php?page=cdbt_tables&tab=modify_table"},l($.ajaxUrl,"post",n,"script");break;case"drop":n={id:"cdbtModal",insertContent:!0,modalTitle:"drop_table",modalBody:"",modalHideEvent:$common_modal_hide,modalExtras:{table_name:$('input[name="custom-database-tables[operate_current_table]"]').val()}},i(n);break;default:$("form.navbar-form").trigger("submit")}}),$("#import-table-upload_filetype").on("changed.fu.selectlist",function(){_.contains(["csv","tsv"],$(this).selectlist("selectedItem").value)?h("switching-item-add_first_line","show"):h("switching-item-add_first_line","hide")});var h=function(e,t){"show"===t?$("#"+e).show():$("#"+e).hide()};_.contains(["csv","tsv"],$("#import-table-upload_filetype").selectlist("selectedItem").value)?h("switching-item-add_first_line","show"):h("switching-item-add_first_line","hide"),$("#button-submit-import_step1").on("click",function(){var e=_.pluck($("#import-table-add_first_line").pillbox("items"),"value");$("#import-table-add_first_line-instance").val(e.join(","))}),"undefined"!=typeof delay_load_importing_sql&&delay_load_importing_sql&&$("#button-submit-import_step2").removeAttr("disabled"),$("#button-submit-import_step2").on("click",function(e){$("#confirm_sql").val("")}),$("#to-view-data").on("click",function(e){var t={session_key:"operate_data",default_action:"view",target_table:$('input[name="custom-database-tables[operate_current_table]"]').val(),callback_url:"/wp-admin/admin.php?page=cdbt_tables&tab=operate_data"};return l($.ajaxUrl,"post",t,"script")}),$("#retry-import").on("click",function(e){$('input[name="custom-database-tables[operate_action]"]').val("import"),$("form.navbar-form").trigger("submit")}),$('button[id^="switch-checkbox-"]').on("click",function(){var e="export_columns"===$(this).attr("id").replace("switch-checkbox-","")?"export-table-target_columns":"import-table-target_columns";$("#"+e+" .checkbox-custom").checkbox("toggle")}),$("#export-table-download_filetype").on("changed.fu.selectlist",function(){_.contains(["csv","tsv"],$(this).selectlist("selectedItem").value)?$("#switching-item-add_index_line").show():$("#switching-item-add_index_line").hide()}),$("#export-table-download_filetype").size()>0&&(_.contains(["csv","tsv"],$("#export-table-download_filetype").selectlist("selectedItem").value)?$("#switching-item-add_index_line").show():$("#switching-item-add_index_line").hide()),$("#button-submit-export_table").on("click",function(e){e.preventDefault();var t=[];$('[id^="export-table-target_columns"]').each(function(){$(this).find(".checkbox-custom").checkbox("isChecked")&&"undefined"!=typeof $(this).children().children("input").val()&&t.push($(this).children().children("input").val())});var a={id:"cdbtModal",insertContent:!0,modalTitle:"export_table",modalHideEvent:"$('input[name=\"custom-database-tables[operate_action]\"]').val('export');",modalExtras:{export_filetype:$("#export-table-download_filetype").selectlist("selectedItem").value,add_index_line:$("#export-table-add_index_line").find(".checkbox-custom").checkbox("isChecked")?$("#export-table-add_index_line input").val():"",output_encoding:$("#export-table-output_encoding").selectlist("selectedItem").value,export_columns:t,export_table:$('[name="custom-database-tables[export_table]"]').val()}};i(a)}),$(document).on("click","#run_export_table",function(){$("#cdbt_file_download_flag").val("true"),$("#form-export_table").submit()}),$(document).on("click","#run_truncate_table",function(){var e={table_name:$('input[name="custom-database-tables[operate_current_table]"]').val(),operate_action:$('input[name="custom-database-tables[operate_action]"]').val(),event:"truncate_table"};l($.ajaxUrl,"post",e,"script")}),$(document).on("click","#run_drop_table",function(){var e={table_name:$('input[name="custom-database-tables[operate_current_table]"]').val(),operate_action:$('input[name="custom-database-tables[operate_action]"]').val(),event:"drop_table"};l($.ajaxUrl,"post",e,"script")})}if("cdbt_tables"===$.QueryString.page&&"operate_data"===$.QueryString.tab){$('button[id^="operate-table-action-"]').on("click",function(e){if(""===$("#operate-table-target_table>ul.dropdown-menu").find('li[data-selected="true"]').attr("data-value"))return e.preventDefault(),!1;var t,a=_.last($(this).attr("id").split("-"));"change_table"===a&&(a="view",t=$("#operate-table-target_table>ul.dropdown-menu").find('li[data-selected="true"]').attr("data-value"),docCookies.setItem("cdbtOperatingTable",t)),$('input[name="custom-database-tables[operate_action]"]').val(a),$('button[id^="operate-table-action-"]').removeClass("active"),$(this).addClass("active"),$common_modal_hide="$('input[name=\"custom-database-tables[operate_action]\"]').val('view'); $('form.navbar-form').trigger('submit');";var n={};if(""===$('input[name="custom-database-tables[operate_current_table]"]').val())n={id:"cdbtModal",insertContent:!0,modalTitle:"table_unknown",modalBody:"",modalHideEvent:$common_modal_hide},i(n);else switch(a){case"view":case"entry":case"edit":return n={session_key:$.QueryString.tab,default_action:a,target_table:$("section").attr("data-target_table"),callback_url:"./admin.php?page="+$.QueryString.page+"&tab="+$.QueryString.tab},l($.ajaxUrl,"post",n,"script");default:$("form.navbar-form").trigger("submit")}}),"undefined"!=typeof $('.repeater[id^="cdbt-repeater-view-"]')&&$('.repeater[id^="cdbt-repeater-view-"]').size()>0&&$(document).on("click",".repeater .binary-data",function(){var e=$(this).children("img").attr("src"),t="",a={id:"cdbtModal",insertContent:!0,modalTitle:"",modalBody:""};"undefined"!=typeof e?(t=e,a.modalTitle="image_preview",a.modalSize="large",a.modalBody='<div class="preview-image-body"><img src="'+t+'" class="center-block"></div>'):(t=$(this).text(),a.modalTitle="binary_downloader",a.modalExtras={table_name:$("section").attr("data-target_table"),target_column:$(this).attr("data-column-name"),where_clause:$(this).attr("data-where-conditions")}),i(a)});var f=function(e){if(1===$("form#"+e).size()){var t=0,a=0;return $("form#"+e).find(".form-group").each(function(){if($(this).find(".required").size()>0||$(this).find(".cdbt-form-required").size()>0){t+=1;var e=0,i=0;$(this).find(".checkbox").size()>0?($(this).find(".checkbox-custom").each(function(){$(this).checkbox("isChecked")&&e++}),0===e&&a++):$(this).find(".selectlist").size()>0?$(this).find(".selectlist").selectlist("selectedItem").selected||a++:$(this).find('input[type="text"]').size()>0?($(this).find('input[type="text"]').each(function(){""!==$(this).val()&&i++}),i!==$(this).find('input[type="text"]').size()&&a++):$(this).find('input[type="number"]').size()>0?($(this).find('input[type="number"]').each(function(){""!==$(this).val()&&i++}),i!==$(this).find('input[type="number"]').size()&&a++):$(this).find("textarea").size()>0?($(this).find("textarea").each(function(){""!==$(this).val()&&i++}),i!==$(this).find("textarea").size()&&a++):$(this).find('input[type="file"]').size()>0}}),0===t||0===a?!0:!1}return!0};"undefined"!=typeof $(".cdbt-entry-data-form")&&$(".cdbt-entry-data-form").size()>0&&($(".cdbt-entry-data-form form .checkbox-custom").on("checked.fu.checkbox unchecked.fu.checkbox",function(){if($(this).hasClass("multiple")){var e=$('input[name="'+$(this).children("input").attr("name").replace("[]","")+'[checked]"]'),t=Number(e.val());$(this).checkbox("isChecked")?t+=1:t-=t>0?1:0,e.val(t)}}),$(document).on("click",'button[id^="btn-entry/"]',function(e){e.preventDefault();var t=$(this).attr("id").split("/"),a=$("#"+t[1]),n=f(t[1]);a.find(".checkbox-custom").each(function(){if($(this).hasClass("multiple")&&$(this).hasClass("required")){var e=$('input[name="'+$(this).children("input").attr("name").replace("[]","")+'[checked]"]'),t=Number(e.val());0===t&&(n=!1)}}),n?(docCookies.setItem("once_action",a.attr("id")),a.submit()):(u={id:"cdbtModal",insertContent:!0,modalTitle:"empty_required_field",modalBody:""},i(u))}));var g=function(e){var t,a,i;e.indexOf("cdbt-repeater-edit-")>-1?(t=$("#"+e).repeater("list_getSelectedItems"),a=$("#"+e+" button#repeater-editor-edit"),i=$("#"+e+" button#repeater-editor-delete")):(t=$("#"+e).find("tbody>tr.selected"),a=$('.cdbt-table-editor[for="'+e+'"] button#table-editor-edit'),i=$('.cdbt-table-editor[for="'+e+'"] button#table-editor-delete')),1===t.length?(a.removeClass("btn-default").addClass("btn-primary").prop("disabled",!1),i.removeClass("btn-default").addClass("btn-primary").prop("disabled",!1)):t.length>1?(a.removeClass("btn-primary").addClass("btn-default").prop("disabled",!0),
i.removeClass("btn-default").addClass("btn-primary").prop("disabled",!1)):(a.removeClass("btn-primary").addClass("btn-default").prop("disabled",!0),i.removeClass("btn-primary").addClass("btn-default").prop("disabled",!0))};$('.repeater[id^="cdbt-repeater-edit-"]').on("selected.fu.repeaterList deselected.fu.repeaterList",function(e){g($(e.target).attr("id"))}),$(document).on("click","#repeater-check-switch",function(e){g($(e.target).attr("id"))}),$(document).on("click",'.cdbt-table-wrapper table[id^="cdbt-table-edit-"] tr.selectable',function(e){if(1===$(e.target).parents("tbody").size())$(e.target).parents("tr.selectable").toggleClass("selected").find(".checkbox label").checkbox("toggle"),g($(e.target).parents("table").attr("id"));else{if(1!==$(e.target).parents("th.editable-checkbox").size()&&"editable-checkbox"!==e.target.className)return!1;$(e.target).parents("tr").find(".checkbox label").checkbox("toggle"),$(e.target).parents("tr").find(".checkbox label").checkbox("isChecked")?$(e.target).parents("table").find("tr.selectable").addClass("selected").find(".checkbox label").checkbox("check"):$(e.target).parents("table").find("tr.selectable").removeClass("selected").find(".checkbox label").checkbox("uncheck"),g($(e.target).parents("table").attr("id"))}}),$(document).on("change",'.cdbt-table-wrapper table[id^="cdbt-table-edit-"] .checkbox input',function(e){1===$(e.target).parents("tbody").size()&&($(e.target).parents("tr.selectable").toggleClass("selected"),g($(e.target).parents("table").attr("id")))}),$('button[id^="repeater-editor-"],button[id^="table-editor-"]').on("click",function(){var e,t=_.last($(this).attr("id").split("-")),a=$(this).attr("id").indexOf("repeater-editor")>-1?!0:!1,n={};switch(e=a?$(this).parents(".repeater").repeater("list_getSelectedItems"):$(this).parents(".cdbt-table-wrapper").find("tbody>tr.selected"),$common_modal_hide="$('input[name=\"custom-database-tables[operate_action]\"]').val('edit'); $('form.navbar-form').trigger('submit');",t){case"refresh":return n={session_key:$.QueryString.tab,default_action:"edit",target_table:$("section").attr("data-target_table"),callback_url:location.replace("./admin.php?page="+$.QueryString.page+"&tab="+$.QueryString.tab)},l($.ajaxUrl,"post",n,"script");case"edit":if(n={id:"cdbtEditData",insertContent:!0,modalTitle:"",modalBody:""},0===e.length)n.id="cdbtEditWarning",n.modalTitle="no_selected_item";else if(e.length>1)n.id="cdbtEditWarning",n.modalTitle="too_many_selected_item";else{var r;r=a?$("tr.selectable.selected label").data("row"):e.find("td.editable-checkbox label").data("row"),n.modalSize="large",n.modalTitle="edit_data_form",n.modalExtras={table_name:$("section").attr("data-target_table"),action_url:"/wp-admin/admin.php?page="+$.QueryString.page+"&tab="+$.QueryString.tab,page:$.QueryString.page,active_tab:$.QueryString.tab,where_clause:r}}i(n);break;case"delete":n={id:"cdbtDeleteData",insertContent:!0,modalTitle:"",modalBody:"",modalExtras:{items:e.length}},0===e.length?n.modalTitle="no_selected_item":n.modalTitle="delete_data",i(n)}}),$(document).on("show.bs.modal","#cdbtEditData",function(){var e={session_key:$.QueryString.tab,table_name:$('input[name="custom-database-tables[operate_current_table]"]').val(),operate_action:$('input[name="custom-database-tables[operate_action]"]').val(),event:"render_edit_form",shortcode:"["+$("#edit-data-form").val()+"]"};return l($.ajaxUrl,"post",e,"html","load_into_modal")}),$(document).on("change","#cdbtEditData div.cdbt-entry-data-form form .checkbox-custom input",function(){if($(this).parent().hasClass("multiple")){var e=$('input[name="'+$(this).attr("name").replace("[]","")+'[checked]"]'),t=Number(e.val());$(this).prop("checked")?t+=1:t-=1,e.val(t)}});$(document).on("click","#run_update_data",function(e){e.preventDefault();var t=$("#cdbtEditData div.cdbt-entry-data-form form"),a=t.attr("id");t.children('input[name="_wp_http_referer"]').val(location.href),f(a)?(docCookies.setItem("once_action",a),t.submit()):($(this).popover({animation:!0,content:$.localErrMsg,placement:"top",trigger:"hover"}).popover("show"),$(this).on("hidden.bs.popover",function(){$(this).popover("destroy")}))}),$(document).on("click","#run_delete_data",function(){var e=$('input[name="custom-database-tables[operate_current_table]"]').val(),t=[];$('.panel-table-wrapper table[id^="cdbt-table-edit-'+e+'"]').size()>0?$('.panel-table-wrapper table[id^="cdbt-table-edit-'+e+'"]').find("tr.selectable.selected label").each(function(){t.push($(this).data("row"))}):$('.repeater[id^="cdbt-repeater-edit-'+e+'"]').find("tr.selectable.selected label.repeater-select-checkbox").each(function(){t.push($(this).data("row"))}),t=_.uniq(t);var a={table_name:e,operate_action:$('input[name="custom-database-tables[operate_action]"]').val(),event:"delete_data",where_conditions:t};return l($.ajaxUrl,"post",a,"script")})}if("cdbt_shortcodes"===$.QueryString.page&&($("td.col-scl-name").find("code").each(function(){$(this).addClass("cdbt-clipboard")}),$(document).on("click","#run_delete_shortcode",function(){var e={csid:$(this).data("csid"),operate_action:"delete",event:"delete_shortcode"};l($.ajaxUrl,"post",e,"script")})),"cdbt_shortcodes"===$.QueryString.page&&("shortcode_register"===$.QueryString.tab||"shortcode_edit"===$.QueryString.tab)){var v="shortcode_register"===$.QueryString.tab?!0:!1,k=v?"register":"edit",y=function(){var e=$('input[name="custom-database-tables[look_feel][enable_repeater]"]').parent(".checkbox-custom").checkbox("isChecked")?"for-rpt":"for-tbl",t=$('input[name="custom-database-tables[display_index_row][]"]').parent(".radio-custom");t.each(function(){$(this).hasClass(e)?($(this).css({position:"relative",display:"inline-block"}),$(this).find("input").prop("disabled",!1)):($(this).css({position:"absolute",display:"none"}),$(this).find("input").prop("disabled",!0))}),$(".switching-item.for-rpt").each(function(){"for-rpt"===e?($(this).css({position:"static",display:"block"}),$(this).find("input").prop("disabled",!1)):($(this).css({position:"absolute",display:"none"}),$(this).find("input").prop("disabled",!0))}),$(".switching-item.for-tbl").each(function(){$(this).hasClass(e)?($(this).css({position:"static",display:"block"}),$(this).find("input").prop("disabled",!1)):($(this).css({position:"absolute",display:"none"}),$(this).find("input").prop("disabled",!0))})};$('input[name="custom-database-tables[look_feel][enable_repeater]"]').on("change",function(){y()});var x=function(){var e=v?$("#register-shortcode-base_name").combobox("selectedItem").text:$("#edit-shortcode-base_name").val(),t="";switch(e){case"cdbt-view":t="on-v";break;case"cdbt-entry":t="on-i";break;case"cdbt-edit":t="on-e";break;default:t=""}$(".switching-item").each(function(){""!==t?$(".toggle-group").css("display","block"):$(".toggle-group").css("display","none"),$(this).hasClass(t)?($(this).css({position:"static",display:"block"}),$(this).find("input").prop("disabled",!1),("on-v"===t||"on-e"===t)&&y()):($(this).css({position:"absolute",display:"none"}),$(this).find("input").prop("disabled",!0))})};$("#register-shortcode-base_name").on("changed.fu.combobox",function(){x()}),x();var w=function(e,t){var a={event:"get_columns_info",table_name:e},i=void 0===t||"show"===t?"show_columns_info":"hide_columns_info";l($.ajaxUrl,"post",a,"html",i)};$("#register-shortcode-target_table, #edit-shortcode-target_table").on("changed.fu.combobox",function(e,t){""!==t.text&&w(t.text)}),$(document).on("click","#collapse-reference",function(){$("#columns-detail").toggleClass("hide"),$("#columns-detail").hasClass("hide")?$(this).children("i").attr("class","fa fa-plus-square"):$(this).children("i").attr("class","fa fa-minus-square")}),$(window).on("load",function(){var e=$("#register-shortcode-target_table, #edit-shortcode-target_table").combobox("selectedItem");""!==e.text&&w(e.text,"hide")});var C=function(){var e=$('input[name^="custom-database-tables["]'),t=$("#"+k+"-shortcode-generate_shortcode"),a=$("#"+k+"-shortcode-alias_code"),i='[base_name table="target_table"attributes]',n="",r="";if(""===$('input[name="custom-database-tables[base_name]"]').val()||""===$('input[name="custom-database-tables[target_table]"]').val())return t.val(""),a.val(""),!1;if(e.each(function(){if(!$(this).prop("disabled")){var e,t=/custom-database-tables\[(\w+)\]{1}(|\[(\w+)?\])$/i;if(_.contains(["text"],$(this).attr("type"))&&""!==$(this).val()&&(e=$(this).attr("name").replace(t,"$1"),_.contains(["base_name","target_table"],e)?i=i.replace(e,$(this).val()):"alias_code"!==e&&(n+=" "+e+'="'+$(this).val()+'"')),_.contains(["checkbox"],$(this).attr("type"))){var a=$(this).attr("name").replace(t,"$1,$3");a=a.split(","),e=a[1].length>0?a[1]:a[0],n+=$(this).is(":checked")?" "+e+'="true"':" "+e+'="false"'}_.contains(["radio"],$(this).attr("type"))&&(e=$(this).attr("name").replace(t,"$1"),$(this).is(":checked")&&(n+=" "+e+'="'+$(this).val()+'"'))}}),r=i.replace("attributes",n),t.val(r),""!==t.val()&&""!==$('input[name="custom-database-tables[csid]"]').val()){var o=i.replace("attributes",' csid="'+$('input[name="custom-database-tables[csid]"]').val()+'"');a.val(o)}};$('input[name^="custom-database-tables["]').on("click blur keydown keypress paste",function(){C()}),$(".checkbox-custom input").on("change",function(e){e.preventDefault(),$(this).parent(".checkbox-custom").hasClass("disabled")&&$(this).parent(".checkbox-custom").checkbox("toggle"),C()}),$(".spinbox").on("changed.fu.spinbox",function(){C()}),$(".combobox").on("changed.fu.combobox",function(){C()}),$("#"+k+"-shortcode-preview").on("click",function(){var e={id:"cdbtModal",insertContent:!0,modalSize:"large",modalTitle:"preview_shortcode",modalBody:"",modalExtras:{shortcode:$("#"+k+"-shortcode-generate_shortcode").val()}};i(e),$(document).on("hide.bs.modal","#cdbtModal",function(){$(this).find(".modal-body").html("")})})}if("cdbt_web_apis"===$.QueryString.page&&$(document).on("click","#run_delete_host",function(){var e={host_id:$(this).data("hostid"),operate_action:"delete",event:"delete_host"};l($.ajaxUrl,"post",e,"script")}),"cdbt_web_apis"===$.QueryString.page&&"api_requests"===$.QueryString.tab){var S=function(){var e=$("#edit-webapi-request-method").selectlist("selectedItem").text,t=[];switch(e){case"get_data":t=["target-columns","conditions","orders","limit","offset"];break;case"find_data":t=["search-key","narrow-operator","target-columns","orders","limit","offset"];break;case"insert_data":t=["upsert_data"];break;case"update_data":t=["upsert_data","pk_value"];break;case"update_where":t=["conditions","upsert_data"];break;case"delete_data":t=["pk_value"]}$(".switching-item").each(function(){var e=_.intersection($(this).context.classList,t);e.length>0?$(this).css("display","block"):$(this).css("display","none"),$(this).hasClass(e[0])?($(this).css({position:"static",display:"block"}),$(this).find("input").prop("disabled",!1)):($(this).css({position:"absolute",display:"none"}),$(this).find("input").prop("disabled",!0))})};$("#edit-webapi-request-method").on("changed.fu.selectlist",function(){S()}),S();var T=function(){var e=$('input[name^="custom-database-tables["]'),t=$("#edit-webapi-request-generate_uri"),a=("http://"+$("#edit-webapi-request-allowed_host").selectlist("selectedItem").text.replace(/\d+\:\s(.*)$/,"$1"),$("#self_host_root").val()),i=a+"/?",n=""!==$("#current_host_apikey").val()?$("#current_host_apikey").val():"",r=""!==$("#edit-webapi-request-target_table").selectlist("selectedItem").value?$("#edit-webapi-request-target_table").selectlist("selectedItem").text:"",o=""!==$("#edit-webapi-request-method").selectlist("selectedItem").value?$("#edit-webapi-request-method").selectlist("selectedItem").text:"";if(""!==n&&""!==r&&""!==o){var s=i+"cdbt_api_key="+$("#preview_nonce").val()+"&cdbt_table="+r+"&cdbt_api_request="+o+"&";i+="cdbt_api_key="+n+"&cdbt_table="+r+"&cdbt_api_request="+o+"&";var c=[];e.each(function(){if(!$(this).prop("disabled")){var e,t=/custom-database-tables\[(\w+)\]{1}(|\[(\w+)\])$/i;_.contains(["text"],$(this).attr("type"))&&""!==$(this).val()&&(e=$(this).attr("name").replace(t,"$1"),_.contains(["allowed_host","target_table","method"],e)||("search_key"===e&&c.push(e+"=["+$(this).val()+"]"),"target_columns"===e&&c.push("columns=["+$(this).val()+"]"),"conditions"===e&&c.push("update_where"===o?"where_conditions={"+$(this).val()+"}":e+"={"+$(this).val()+"}"),"upsert_data"===e&&c.push("data={"+$(this).val()+"}"),"pk_value"===e&&c.push("primary_key_value="+$(this).val()),"orders"===e&&c.push("order={"+$(this).val()+"}"),("limit"===e||"offset"===e)&&Number($(this).val())>0&&c.push(e+"="+$(this).val())))}}),t.val(i+c.join("&")),$("#preview_uri").val(s+c.join("&")),$("#webapi-preview").prop("disabled",!1)}else $("#webapi-preview").attr("disabled",!0)};$('input[name^="custom-database-tables["]').on("click blur keydown keypress paste",function(){T()}),$(".spinbox").on("changed.fu.spinbox",function(){T()}),$(".selectlist").on("changed.fu.selectlist",function(){if("edit-webapi-request-allowed_host"===$(this).attr("id")){var e={host_id:$(this).selectlist("selectedItem").value,operate_action:"retrieve",event:"get_apikey"};l($.ajaxUrl,"post",e,"text","set_api_key")}T()}),T(),$("#webapi-preview").on("click",function(){var e={id:"cdbtModal",insertContent:!0,modalSize:"large",modalTitle:"preview_request_api",modalBody:"",modalExtras:{request_uri:$("#preview_uri").val()}};i(e)})}if("cdbt_management_console"===$.QueryString.page&&($("#show-tutorial").on("click",function(e){var t={event:"update_options",hide_tutorial:!1};l($.ajaxUrl,"post",t,"script")}),docCookies.hasItem("cdbtOperatingTable")&&docCookies.removeItem("cdbtOperatingTable"),docCookies.hasItem("cdbtSortCache")&&docCookies.removeItem("cdbtSortCache")),"cdbt_options"===$.QueryString.page&&$("#initialize").on("click",function(e){e.preventDefault(),$(this).parents("form").children("input[name=action]").val($(this).attr("id")),$("#submit").trigger("click")}),"cdbt_options"===$.QueryString.page&&"messages"===$.QueryString.tab&&($("#override-messages").on("click",function(e){e.preventDefault(),$(this).parents("form").children("input[name=action]").val("override");var t=0;return $('textarea[id^="override-messages-"]').each(function(){$(this).val()===$("#"+$(this).attr("id")+"-default").text()?$(this).prop("disabled",!0):t++}),t>0?void $(this).parents("form").submit():($('textarea[id^="override-messages-"]').prop("disabled",!1),u={id:"cdbtModal",insertContent:!0,modalTitle:"changing_item_none",modalBody:""},i(u),!1)}),$("#format-messages").on("click",function(e){e.preventDefault(),$(this).parents("form").children("input[name=action]").val("format"),$(this).parents("form").submit()})),"cdbt_options"===$.QueryString.page&&"debug"===$.QueryString.tab){var D=$("#debug-log-viewer");D.scrollTop(D[0].scrollHeight-D.height())}"cdbt_options"===$.QueryString.page&&"addons"===$.QueryString.tab&&$(".addon-btn").find("button").on("click",function(e){var t=$(this).parents("#cdbt-addons");t.find("#cdbt-addon-classname").val($(this).data("className")),t.find("#cdbt-addon-disturi").val($(this).data("distUri"))}),$(document).on("click","a.collapse-col-data",function(){u={id:"cdbtModal",insertContent:!0,modalTitle:"view_item_full",modalBody:$(this).data("raw")},i(u)})});var convert_datetime=function(){if(arguments.length<2)return 1===arguments.length?arguments[0]:!1;if("undefined"==typeof arguments[0]||!arguments[0])return"-";var e=arguments[0].replace(/\-/g,"/"),t=new Date(e),a=arguments[1].join(" ");if(""===a)return arguments[0];var i=a.split(""),n="",r=function(e){var t=new Date(e.getFullYear(),e.getMonth()+1,1);return t.setTime(t.getTime()-1),t.getDate()},o=function(){for(var e=new Date(t.getFullYear(),0,1),a=0,i=0;12>i;i++)e.setMonth(i),a+=r(e);return 365===a?0:1},s=function(){for(var e=new Date(t.getFullYear(),0,1),a=-1,i=0;i<t.getMonth();i++)e.setMonth(i),a+=r(e);return a+t.getDate()};return _.each(i,function(e){var a,i={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"},c={Sun:"Sunday",Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thurseday",Fri:"Friday",Sat:"Saturday"},d=function(){var e=t.getHours();return e>12?e-12:e},l=function(){var e=t.getHours();return e>12?"pm":"am"};switch(e){case"Y":case"o":a=t.getFullYear();break;case"y":a=(""+t.getFullYear()).slice(-2);break;case"m":a=("0"+(t.getMonth()+1)).slice(-2);break;case"n":a=t.getMonth()+1;break;case"F":a=_.values(i)[t.getMonth()];break;case"M":a=_.keys(i)[t.getMonth()];break;case"d":a=("0"+t.getDate()).slice(-2);break;case"j":a=t.getDate();break;case"S":var u=["st","nd","rd","th"],p=function(){var e=t.getDate();return 1===e||2===e||3===e||21===e||22===e||23===e||31===e?Number((""+e).slice(-1)-1):3};a=u[p()];break;case"w":case"W":a=t.getDay();break;case"l":a=_.values(c)[t.getDay()];break;case"D":a=_.keys(c)[t.getDay()];break;case"N":a=0===t.getDay()?7:t.getDay();break;case"a":a=l();break;case"A":a=l().toUpperCase();break;case"g":a=d();break;case"h":a=("0"+d()).slice(-2);break;case"G":a=t.getHours();break;case"H":a=("0"+t.getHours()).slice(-2);break;case"i":a=("0"+t.getMinutes()).slice(-2);break;case"s":a=("0"+t.getSeconds()).slice(-2);break;case"z":a=s();break;case"t":a=r(t);break;case"L":a=o();break;case"c":a=arguments[0].replace(" ","T")+"+00:00";break;case"r":a=t;break;case"u":a="000000";break;case"e":case"T":case"B":case"I":case"O":case"P":case"Z":case"U":a="";break;default:a=e}n+=a}),n},isSurrogatePear=function(e,t){return e>=55296&&56319>=e&&t>=56320&&57343>=t},mb_strlen=function(e){for(var t=0,a=0;a<e.length;a++,t++){var i=e.charCodeAt(a),n=e.length>a+1?e.charCodeAt(a+1):0;isSurrogatePear(i,n)&&a++}return t},mb_substr=function(e,t,a){for(var i="",n=0,r=0;n<e.length;n++,r++){var o=e.charCodeAt(n),s=e.length>n+1?e.charCodeAt(n+1):0,c="";isSurrogatePear(o,s)?(n++,c=String.fromCharCode(o,s)):c=String.fromCharCode(o),r>=t&&a>r&&(i+=c)}return i},strip_tags=function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var a=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,i=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return e.replace(i,"").replace(a,function(e,a){return t.indexOf("<"+a.toLowerCase()+">")>-1?e:""})},strip_slashes=function(e){return(e+"").replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return t}})},cdbtCustomColumnFilter=function(e,t){t=t||100;var a=$("<div/>").html(strip_tags(_.unescape(e),"<a><b><strong><em><i>")).text(),i=strip_slashes(e);if(mb_strlen(a)>t){var n=mb_substr(a,0,t-1);e=n+'<a href="javascript:;" class="btn btn-default btn-sm collapse-col-data" data-raw="'+i+'"><i class="fa fa-ellipsis-h" aria-hidden="true"></i> <i class="fa fa-level-up" aria-hidden="true"></i></a>'}else e=a;return e};
//# sourceMappingURL=cdbt-admin.js.map
